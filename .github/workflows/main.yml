name: Publish docker images on docker hub
run-name: Publishing docker images
# on:
#   release:
#     types: [published]
on: push
jobs:
  Build-and-publish-for-i386: 
    runs-on: ubuntu-latest
    steps:
      - uses: actions-ecosystem/action-regex-match@v2
        id: regex-match
        with:
          text: ${{ github.ref_name }}
          regex: '^v\d+\.\d+\.\d+\$'

      - name: Check out repository code
        uses: actions/checkout@v3

      - name: Login to docker hub
        run: |
          echo "[${{ secrets.DOCKER_USER }}]";
          echo "${{ secrets.DOCKER_TOKEN }}" | docker login -u "${{ secrets.DOCKER_USER }}" --password-stdin

      - name: Create 
        run: |
          echo $;
          ./build.sh i386

      - name: Tag and push 
        run: |
          IMAGE=$(cat /tmp/IMAGE);
          docker push $IMAGE

  Build-and-publish-for-amd64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions-ecosystem/action-regex-match@v2
        id: regex-match
        with:
          text: ${{ github.ref_name }}
          regex: '^v\d+\.\d+\.\d+\$'

      - name: Check out repository code
        uses: actions/checkout@v3

      - name: Login to docker hub
        run: |
          echo "[${{ secrets.DOCKER_USER }}]";
          echo "${{ secrets.DOCKER_TOKEN }}" | docker login -u "${{ secrets.DOCKER_USER }}" --password-stdin

      - name: Create 
        run: |
          ./build.sh amd64

      - name: Tag and push 
        run: |
          IMAGE=$(cat /tmp/IMAGE);
          docker push $IMAGE
